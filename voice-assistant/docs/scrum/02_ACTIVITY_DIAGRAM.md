# Activity Diagrams

## Project: Hyper-Localized Multilingual Voice Assistant

---

## 1. Voice Command Processing Flow

### 1.1 Main Activity Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACTIVITY DIAGRAM: Voice Command Flow                      │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌───────────┐
                              │   START   │
                              └─────┬─────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │ User Speaks Command │
                         │   (Malayalam)       │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Capture Audio      │
                         │  (Microphone)       │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  ASR Processing     │
                         │  (Meta ASR 1B)      │
                         │  [ONLINE]           │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Malayalam Text     │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Translate ML → EN  │
                         │  (IndicTrans2)      │
                         │  [LOCAL]            │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  English Text       │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  LLM Processing     │
                         │  (Qwen 2.5 1.5B)    │
                         │  [LOCAL]            │
                         └──────────┬──────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
            ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
            │   Answer    │ │   Execute   │ │   Agent     │
            │   Query     │ │   Task      │ │   Action    │
            └──────┬──────┘ └──────┬──────┘ └──────┬──────┘
                    │               │               │
                    └───────────────┼───────────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  English Response   │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Translate EN → ML  │
                         │  (IndicTrans2)      │
                         │  [LOCAL]            │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Malayalam Response │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  TTS Synthesis      │
                         │  (MMS-TTS)          │
                         │  [LOCAL]            │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Play Audio         │
                         │  (Speaker)          │
                         └──────────┬──────────┘
                                    │
                                    ▼
                              ┌───────────┐
                              │    END    │
                              └───────────┘
```

---

### 1.2 Swimlane Diagram (Component Responsibility)

```
┌──────────────┬───────────────┬───────────────┬───────────────┬───────────────┐
│    USER      │     ASR       │  TRANSLATION  │     LLM       │     TTS       │
├──────────────┼───────────────┼───────────────┼───────────────┼───────────────┤
│              │               │               │               │               │
│  ┌───────┐   │               │               │               │               │
│  │ Speak │   │               │               │               │               │
│  └───┬───┘   │               │               │               │               │
│      │       │               │               │               │               │
│      ▼       │               │               │               │               │
│  ┌───────┐   │               │               │               │               │
│  │ Audio │───┼──────►        │               │               │               │
│  └───────┘   │       │       │               │               │               │
│              │       ▼       │               │               │               │
│              │  ┌─────────┐  │               │               │               │
│              │  │Meta ASR │  │               │               │               │
│              │  │  1B     │  │               │               │               │
│              │  └────┬────┘  │               │               │               │
│              │       │       │               │               │               │
│              │       ▼       │               │               │               │
│              │  Malayalam ───┼──────►        │               │               │
│              │    Text       │       │       │               │               │
│              │               │       ▼       │               │               │
│              │               │  ┌─────────┐  │               │               │
│              │               │  │IndicTr- │  │               │               │
│              │               │  │ ans2    │  │               │               │
│              │               │  │ ML→EN   │  │               │               │
│              │               │  └────┬────┘  │               │               │
│              │               │       │       │               │               │
│              │               │       ▼       │               │               │
│              │               │  English ─────┼──────►        │               │
│              │               │    Text       │       │       │               │
│              │               │               │       ▼       │               │
│              │               │               │  ┌─────────┐  │               │
│              │               │               │  │ Qwen    │  │               │
│              │               │               │  │ 2.5     │  │               │
│              │               │               │  └────┬────┘  │               │
│              │               │               │       │       │               │
│              │               │               │       ▼       │               │
│              │               │       ◄───────┼── English     │               │
│              │               │       │       │   Response    │               │
│              │               │       ▼       │               │               │
│              │               │  ┌─────────┐  │               │               │
│              │               │  │IndicTr- │  │               │               │
│              │               │  │ ans2    │  │               │               │
│              │               │  │ EN→ML   │  │               │               │
│              │               │  └────┬────┘  │               │               │
│              │               │       │       │               │               │
│              │               │       ▼       │               │               │
│              │               │  Malayalam ───┼───────────────┼──────►        │
│              │               │   Response    │               │       │       │
│              │               │               │               │       ▼       │
│              │               │               │               │  ┌─────────┐  │
│              │               │               │               │  │ MMS-TTS │  │
│              │               │               │               │  └────┬────┘  │
│              │               │               │               │       │       │
│      ◄───────┼───────────────┼───────────────┼───────────────┼───────┘       │
│      │       │               │               │               │               │
│      ▼       │               │               │               │               │
│  ┌───────┐   │               │               │               │               │
│  │ Hear  │   │               │               │               │               │
│  └───────┘   │               │               │               │               │
│              │               │               │               │               │
└──────────────┴───────────────┴───────────────┴───────────────┴───────────────┘
     LOCAL           ONLINE           LOCAL           LOCAL           LOCAL
```

---

## 2. System Initialization Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACTIVITY DIAGRAM: System Startup                          │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌───────────┐
                              │   START   │
                              └─────┬─────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Load Configuration │
                         │  (settings.yaml)    │
                         └──────────┬──────────┘
                                    │
                                    ▼
                              ◇ Config Valid? ◇
                             ╱              ╲
                           Yes              No
                           ╱                  ╲
                          ▼                    ▼
               ┌─────────────────┐   ┌─────────────────┐
               │  Continue       │   │  Exit with      │
               └────────┬────────┘   │  Error          │
                        │            └─────────────────┘
                        │
     ╔══════════════════╧═══════════════════╗
     ║           PARALLEL LOADING            ║
     ╠═══════════╦═══════════╦══════════════╣
     ║           ║           ║              ║
     ▼           ▼           ▼              ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────┐
│ Load    │ │ Load    │ │ Load    │ │ Initialize  │
│ Trans-  │ │ Qwen    │ │ MMS-TTS │ │ Audio       │
│ lation  │ │ LLM     │ │         │ │ Handler     │
│ Model   │ │         │ │         │ │             │
└────┬────┘ └────┬────┘ └────┬────┘ └──────┬──────┘
     │           │           │             │
     ║           ║           ║             ║
     ╚═══════════╩═══════════╩═════════════╝
                        │
                        ▼
                  ◇ All Loaded? ◇
                 ╱              ╲
               Yes              No
               ╱                  ╲
              ▼                    ▼
   ┌─────────────────┐   ┌─────────────────┐
   │ Log "Models     │   │ Retry Failed    │
   │ Loaded"         │   │ Components      │
   └────────┬────────┘   └────────┬────────┘
            │                     │
            │              ◇ Retry OK? ◇
            │             ╱          ╲
            │           Yes          No
            │           ╱              ╲
            │◄─────────┘                ▼
            │                 ┌─────────────────┐
            │                 │  Exit with      │
            │                 │  Error          │
            │                 └─────────────────┘
            │
            ▼
   ┌─────────────────┐
   │ Start API Server│
   │ (FastAPI)       │
   └────────┬────────┘
            │
            ▼
   ┌─────────────────┐
   │ System Ready    │
   │ ✓ Listening     │
   └────────┬────────┘
            │
            ▼
      ┌───────────┐
      │    END    │
      └───────────┘
```

---

## 3. Error Handling Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACTIVITY DIAGRAM: Error Handling                          │
└─────────────────────────────────────────────────────────────────────────────┘

                         ┌─────────────────────┐
                         │   Error Detected    │
                         └──────────┬──────────┘
                                    │
                                    ▼
                              ◇ Error Type? ◇
                    ┌───────────┼───────────┐
                    │           │           │
                    ▼           ▼           ▼
             ┌───────────┐ ┌─────────┐ ┌───────────┐
             │ ASR Error │ │   LLM   │ │ TTS Error │
             │           │ │  Error  │ │           │
             └─────┬─────┘ └────┬────┘ └─────┬─────┘
                   │            │            │
                   ▼            ▼            ▼
          ┌──────────────┐ ┌─────────┐ ┌──────────────┐
          │ Try Whisper  │ │ Return  │ │ Return Text  │
          │ Fallback     │ │ Default │ │ Response     │
          └──────┬───────┘ │ Message │ │ (No Audio)   │
                 │         └────┬────┘ └──────┬───────┘
                 │              │             │
                 ▼              │             │
          ◇ Fallback OK? ◇     │             │
         ╱            ╲        │             │
       Yes            No       │             │
       ╱                ╲      │             │
      ▼                  ▼     │             │
┌───────────┐    ┌───────────┐ │             │
│ Continue  │    │ Ask User  │ │             │
│ Pipeline  │    │ to Repeat │ │             │
└─────┬─────┘    └─────┬─────┘ │             │
      │                │       │             │
      └────────────────┼───────┼─────────────┘
                       │       │
                       ▼       │
               ┌─────────────┐ │
               │ Log Error   │◄┘
               └──────┬──────┘
                      │
                      ▼
               ┌─────────────┐
               │  Continue   │
               │  Listening  │
               └─────────────┘
```

---

## 4. Agent Workflow Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACTIVITY DIAGRAM: Agent Processing                        │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌───────────┐
                              │   START   │
                              └─────┬─────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Receive English    │
                         │  Query from LLM     │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Intent Detection   │
                         │  (LangGraph Router) │
                         └──────────┬──────────┘
                                    │
                                    ▼
                              ◇ Intent Type? ◇
              ┌─────────────────┼─────────────────┐
              │                 │                 │
              ▼                 ▼                 ▼
       ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
       │ INFORMATION │   │    TASK     │   │  SMART HOME │
       │    QUERY    │   │  EXECUTION  │   │   CONTROL   │
       └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
              │                 │                 │
              ▼                 ▼                 ▼
       ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
       │ Info Agent  │   │ Task Agent  │   │ IoT Agent   │
       │ - Search    │   │ - Reminder  │   │ - Device    │
       │ - Q&A       │   │ - Calendar  │   │   Control   │
       │ - Facts     │   │ - Calculate │   │ - Status    │
       └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
              │                 │                 │
              ▼                 ▼                 ▼
       ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
       │ Execute     │   │ Execute     │   │ Execute     │
       │ Tool(s)     │   │ Tool(s)     │   │ Tool(s)     │
       └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
              │                 │                 │
              └─────────────────┼─────────────────┘
                                │
                                ▼
                         ┌─────────────────────┐
                         │  Format Response    │
                         └──────────┬──────────┘
                                    │
                                    ▼
                         ┌─────────────────────┐
                         │  Return to LLM      │
                         │  for Final Response │
                         └──────────┬──────────┘
                                    │
                                    ▼
                              ┌───────────┐
                              │    END    │
                              └───────────┘
```

---

## 5. Component Latency Breakdown

```
Timeline (milliseconds)
    │
  0 ├── User speaks ──────────────────────────────────┐
    │                                                  │
100 ├── Audio capture complete ───────────────────────┤
    │                                                  │
200 ├──────────────────────────────────────────────────┤
    │         ┌─────────────────────────────┐         │
300 ├─────────│      ASR Processing         │─────────┤
    │         │      (Meta ASR 1B)          │         │
400 ├─────────│      ~500-800ms             │─────────┤
    │         │      [ONLINE]               │         │
500 ├─────────└─────────────────────────────┘─────────┤
    │                                                  │
600 ├──────────────────────────────────────────────────┤
    │         ┌─────────────────────────────┐         │
700 ├─────────│    Translation ML→EN        │─────────┤
    │         │    (IndicTrans2)            │         │
800 ├─────────│    ~100-200ms [LOCAL]       │─────────┤
    │         └─────────────────────────────┘         │
    │                                                  │
900 ├──────────────────────────────────────────────────┤
    │         ┌─────────────────────────────┐         │
1000├─────────│    LLM Processing           │─────────┤
    │         │    (Qwen 2.5 1.5B)          │         │
1100├─────────│    ~300-500ms [LOCAL]       │─────────┤
    │         └─────────────────────────────┘         │
    │                                                  │
1200├──────────────────────────────────────────────────┤
    │         ┌─────────────────────────────┐         │
1300├─────────│    Translation EN→ML        │─────────┤
    │         │    ~100-200ms [LOCAL]       │─────────┤
    │         └─────────────────────────────┘         │
    │                                                  │
1400├──────────────────────────────────────────────────┤
    │         ┌─────────────────────────────┐         │
1500├─────────│    TTS Synthesis            │─────────┤
    │         │    (MMS-TTS)                │         │
1600├─────────│    ~200-400ms [LOCAL]       │─────────┤
    │         └─────────────────────────────┘         │
    │                                                  │
1700├── Audio playback begins ────────────────────────┘
    │
    ▼

    Total Latency: ~1.5-2.5 seconds (Target: <3 seconds) ✓
```

---

*Document Version: 1.0*
*Last Updated: Sprint 2*
